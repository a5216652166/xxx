<!DOCTYPE html>
<html>
<head>

<include file="Public:include" />

<link href="__ROOT__/Public/js/jquery.chosen/chosen.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="__ROOT__/Public/js/jquery.chosen/chosen.jquery.js"></script>

<script type="text/javascript">
	$(function() {
		$(".chzn-select").chosen();

		$("#cancelbutton").click(function(){
			back('{$return_url}');
		});

		$("select[name=PoolCode]").change(function(){
			var poolCode = $(this).val();

			$.ajax({
				url : '__URL__/get_vps',
				type : 'GET',
				data : {'PoolCode':poolCode},
				dataType : 'json',
				success : function(data){
					var $p = $("select[name=PropertyCode]");
					$p.html('');

					for(var k in data){
						$p.append('<option value="' + data[k].Code + '">' + data[k].Code + '</option>');
					}

					$p.trigger('chosen:updated');
				}
			});

			$.ajax({
				url : '__APP__/Pool/get_pool',
				type : 'GET',
				data : {'PoolCode':poolCode},
				dataType : 'json',
				success : function(data){
					$("#ipHint").html("当前池的控制IP段：" + data.ControlIPBegin + " -- " + data.ControlIPEnd);
					$(":text[name='ControlIP']").val(data.ControlIPBegin);
				}
			});
		});

		//初始化资产
		$("select[name=PoolCode]").change();

		$("#addForm").submit(function(){
			$("#errorMsg").empty();
			var msg = '';

			var poolCode = $("select[name='PoolCode']").val();
			var ip = $(":text[name='ControlIP']").val();

			$.ajax({
				url : '__APP__/Host/checkIP',
				async: false,
				type : 'GET',
				data : {'PoolCode':poolCode, 'IP':ip},
				dataType : 'json',
				success : function(data){
					if(data.ret != 0){
						msg = data.msg;
					}
				}
			});

			if(msg != ''){
				$("#errorMsg").html(msg);
				return false;
			}

			return true;
		});

	});

</script>

</head>

<body>
	<div id="container">
		<form id="addForm" action="__URL__/add" method="post">
			<table class="table" cellspacing="0" cellpadding="0" width="100%" >
			    <tr>
			      <th colspan="2" class="ui_text_lt">
			      	添加主机
			      	<span id="errorMsg" class="errmsg">{$errorMsg}</span>
			      </th>
			    </tr>
			    <tr>
			      <td width="100px">池编号：</td>
			      <td class="ui_text_lt">
			      	<select name="PoolCode" class="chzn-select ui_select03">
			      		<volist name="pools" id="vo">
			      			<option value="{$vo.PoolCode}">{$vo.PoolCode}</option>
			      		</volist>
			      	</select>
			      </td>
			    </tr>
			    <tr>
			      <td width="100px">资产编号：</td>
			      <td class="ui_text_lt">
			      	<select name="PropertyCode" class="chzn-select ui_select03">
			      	</select>
			      </td>
			    </tr>
			    <tr>
			      <td width="100px">控制IP：</td>
			      <td class="ui_text_lt">
			      	<span id="ipHint" style="margin-left: 5px; color: red;"></span>
			      	<br/>
			      	<input type="text" name="ControlIP" class="ui_input_txt03" />
			      </td>
			    </tr>
			    <tr>
					<td class="ui_text_ct" colspan="2">
						      <input id="submitbutton" type="submit" value="提交" class="ui_input_btn01"/>
						&nbsp;<input id="cancelbutton" type="button" value="取消" class="ui_input_btn01"/>
					</td>
			    </tr>
			</table>
		</form>
	</div>
</body>
</html>
